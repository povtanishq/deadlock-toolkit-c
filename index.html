<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deadlock Toolkit - Interactive Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            padding: 40px 20px;
        }

        h1 {
            font-size: 3.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 1.3em;
            opacity: 0.95;
        }

        nav {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 15px 30px;
            background: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            color: #667eea;
        }

        .nav-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.2);
        }

        .nav-btn.active {
            background: #667eea;
            color: white;
        }

        .content-section {
            background: white;
            border-radius: 20px;
            padding: 50px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            display: none;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 2.5em;
            text-align: center;
        }

        .description {
            font-size: 1.1em;
            color: #555;
            line-height: 1.8;
            margin-bottom: 30px;
            text-align: center;
        }

        .demo-container {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 12px;
            margin: 30px 0;
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .input-group {
            margin: 15px 0;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
            font-size: 1.05em;
        }

        input, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border 0.3s;
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .run-btn {
            background: #667eea;
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            margin-top: 15px;
            transition: all 0.3s;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .run-btn:hover {
            background: #764ba2;
            transform: scale(1.05);
        }

        .output {
            background: #1e1e1e;
            color: #0f0;
            padding: 25px;
            border-radius: 10px;
            margin-top: 25px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 500px;
            overflow-y: auto;
            font-size: 1.05em;
            line-height: 1.6;
        }

        .graph-viz {
            margin: 30px 0;
            padding: 30px;
            background: white;
            border: 3px solid #667eea;
            border-radius: 12px;
            text-align: center;
        }

        .node {
            display: inline-block;
            padding: 20px 25px;
            margin: 15px;
            border-radius: 50%;
            font-weight: bold;
            font-size: 1.3em;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .process-node {
            background: #667eea;
            color: white;
        }

        .resource-node {
            background: #764ba2;
            color: white;
        }

        .arrow {
            display: inline-block;
            font-size: 2em;
            color: #667eea;
            margin: 0 10px;
        }

        .safe-state {
            color: #28a745;
            font-weight: bold;
        }

        .unsafe-state {
            color: #dc3545;
            font-weight: bold;
        }

        .example-btn {
            background: #764ba2;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.95em;
            margin: 5px;
            transition: all 0.3s;
        }

        .example-btn:hover {
            background: #667eea;
        }

        .matrix-display {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 2px solid #ddd;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        th, td {
            padding: 12px;
            text-align: center;
            border: 1px solid #ddd;
        }

        th {
            background: #667eea;
            color: white;
            font-weight: bold;
        }

        tr:nth-child(even) {
            background: #f8f9fa;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üîí Deadlock Toolkit</h1>
            <p class="subtitle">Interactive Deadlock Prevention & Detection System</p>
        </header>

        <nav>
            <button class="nav-btn active" onclick="showSection('bankers')">Banker's Algorithm</button>
            <button class="nav-btn" onclick="showSection('rag')">RAG Detection</button>
            <button class="nav-btn" onclick="showSection('recovery')">Deadlock Recovery</button>
        </nav>

        <!-- Banker's Algorithm Section -->
        <div class="content-section active" id="bankers">
            <h2>üè¶ Banker's Algorithm</h2>
            <p class="description">
                The Banker's Algorithm is a deadlock avoidance algorithm that tests for safety by simulating the allocation of predetermined maximum possible amounts of all resources, then makes an "s-state" check to test for possible activities before deciding whether allocation should be allowed to continue.
            </p>

            <div style="text-align: center; margin: 20px 0;">
                <button class="example-btn" onclick="loadExample('safe')">Load Safe Example</button>
                <button class="example-btn" onclick="loadExample('unsafe')">Load Unsafe Example</button>
            </div>

            <div class="demo-container">
                <div class="input-row">
                    <div class="input-group">
                        <label>Number of Processes:</label>
                        <input type="number" id="processes" value="5" min="1" max="10">
                    </div>
                    <div class="input-group">
                        <label>Number of Resources:</label>
                        <input type="number" id="resources" value="3" min="1" max="10">
                    </div>
                </div>

                <div class="input-group">
                    <label>Allocation Matrix (comma-separated rows):</label>
                    <textarea id="allocation" rows="5">0,1,0
2,0,0
3,0,2
2,1,1
0,0,2</textarea>
                </div>

                <div class="input-group">
                    <label>Max Need Matrix (comma-separated rows):</label>
                    <textarea id="max" rows="5">7,5,3
3,2,2
9,0,2
2,2,2
4,3,3</textarea>
                </div>

                <div class="input-group">
                    <label>Available Resources (comma-separated):</label>
                    <input type="text" id="available" value="3,3,2">
                </div>

                <button class="run-btn" onclick="runBankersAlgorithm()">üöÄ Check Safety State</button>
                <div class="output" id="bankers-output"></div>
            </div>
        </div>

        <!-- RAG Detection Section -->
        <div class="content-section" id="rag">
            <h2>üï∏Ô∏è Resource Allocation Graph (RAG) Detection</h2>
            <p class="description">
                A Resource Allocation Graph is a directed graph used to detect deadlocks in a system. It consists of processes and resources as nodes, with edges representing allocation and request relationships. A cycle in the graph indicates a potential deadlock.
            </p>

            <div style="text-align: center; margin: 20px 0;">
                <button class="example-btn" onclick="loadRAGExample('nocycle')">No Cycle Example</button>
                <button class="example-btn" onclick="loadRAGExample('cycle')">Deadlock Cycle Example</button>
            </div>

            <div class="demo-container">
                <div class="input-row">
                    <div class="input-group">
                        <label>Number of Processes:</label>
                        <input type="number" id="rag-processes" value="3" min="1" max="10">
                    </div>
                    <div class="input-group">
                        <label>Number of Resources:</label>
                        <input type="number" id="rag-resources" value="3" min="1" max="10">
                    </div>
                </div>

                <div class="input-group">
                    <label>Allocation Matrix (comma-separated rows):</label>
                    <textarea id="rag-allocation" rows="4">0,1,0
2,0,0
3,0,2</textarea>
                </div>

                <div class="input-group">
                    <label>Request Matrix (comma-separated rows):</label>
                    <textarea id="rag-request" rows="4">0,0,0
2,0,2
0,0,0</textarea>
                </div>

                <button class="run-btn" onclick="detectDeadlock()">üîç Detect Deadlock</button>
                
                <div class="graph-viz" id="rag-viz"></div>
                <div class="output" id="rag-output"></div>
            </div>
        </div>

        <!-- Recovery Section -->
        <div class="content-section" id="recovery">
            <h2>üîß Deadlock Recovery</h2>
            <p class="description">
                When a deadlock is detected, the system must recover by breaking the circular wait condition. This is typically done by terminating processes or preempting resources. The victim selection algorithm chooses which process to terminate based on various factors like resource usage.
            </p>

            <div class="demo-container">
                <div class="input-row">
                    <div class="input-group">
                        <label>Number of Processes:</label>
                        <input type="number" id="rec-processes" value="4" min="1" max="10">
                    </div>
                    <div class="input-group">
                        <label>Number of Resources:</label>
                        <input type="number" id="rec-resources" value="3" min="1" max="10">
                    </div>
                </div>

                <div class="input-group">
                    <label>Allocation Matrix (comma-separated rows):</label>
                    <textarea id="rec-allocation" rows="4">0,1,0
2,0,0
3,0,2
2,1,1</textarea>
                </div>

                <div class="input-group">
                    <label>Available Resources (comma-separated):</label>
                    <input type="text" id="rec-available" value="0,0,0">
                </div>

                <button class="run-btn" onclick="recoverDeadlock()">‚ö° Execute Recovery</button>
                <div class="output" id="recovery-output"></div>
            </div>
        </div>
    </div>

    <script>
        function showSection(section) {
            document.querySelectorAll('.content-section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            
            document.getElementById(section).classList.add('active');
            event.target.classList.add('active');
        }

        function loadExample(type) {
            if (type === 'safe') {
                document.getElementById('processes').value = 5;
                document.getElementById('resources').value = 3;
                document.getElementById('allocation').value = '0,1,0\n2,0,0\n3,0,2\n2,1,1\n0,0,2';
                document.getElementById('max').value = '7,5,3\n3,2,2\n9,0,2\n2,2,2\n4,3,3';
                document.getElementById('available').value = '3,3,2';
            } else {
                document.getElementById('processes').value = 3;
                document.getElementById('resources').value = 3;
                document.getElementById('allocation').value = '0,1,0\n2,0,0\n3,0,3';
                document.getElementById('max').value = '7,5,3\n3,2,2\n9,0,2';
                document.getElementById('available').value = '2,3,0';
            }
        }

        function runBankersAlgorithm() {
            const n = parseInt(document.getElementById('processes').value);
            const m = parseInt(document.getElementById('resources').value);
            
            const allocation = document.getElementById('allocation').value.split('\n').map(row => row.split(',').map(Number));
            const max = document.getElementById('max').value.split('\n').map(row => row.split(',').map(Number));
            const available = document.getElementById('available').value.split(',').map(Number);
            
            const need = allocation.map((row, i) => row.map((val, j) => max[i][j] - val));
            
            const work = [...available];
            const finish = Array(n).fill(false);
            const safeSeq = [];
            
            let output = 'üîÑ RUNNING BANKER\'S ALGORITHM...\n\n';
            output += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n';
            
            output += 'NEED MATRIX:\n';
            need.forEach((row, i) => {
                output += `P${i}: [${row.join(', ')}]\n`;
            });
            output += '\n';
            
            let iteration = 0;
            let found = true;
            while (safeSeq.length < n && found) {
                found = false;
                output += `\nIteration ${++iteration}:\n`;
                output += `Work: [${work.join(', ')}]\n`;
                
                for (let i = 0; i < n; i++) {
                    if (!finish[i]) {
                        let canAllocate = true;
                        for (let j = 0; j < m; j++) {
                            if (need[i][j] > work[j]) {
                                canAllocate = false;
                                break;
                            }
                        }
                        if (canAllocate) {
                            output += `  ‚úì P${i} can finish (Need ‚â§ Work)\n`;
                            for (let j = 0; j < m; j++) {
                                work[j] += allocation[i][j];
                            }
                            output += `    Releasing: [${allocation[i].join(', ')}]\n`;
                            output += `    New Work: [${work.join(', ')}]\n`;
                            safeSeq.push(i);
                            finish[i] = true;
                            found = true;
                        }
                    }
                }
            }
            
            output += '\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n';
            
            if (safeSeq.length === n) {
                output += '<span class="safe-state">‚úÖ SYSTEM IS IN SAFE STATE</span>\n\n';
                output += `Safe Sequence: P${safeSeq.join(' ‚Üí P')}\n\n`;
                output += 'Resources can be allocated safely to all processes.\n';
                output += 'No deadlock will occur!';
            } else {
                output += '<span class="unsafe-state">‚ùå SYSTEM IS IN UNSAFE STATE</span>\n\n';
                output += 'No safe sequence exists.\n';
                output += 'System may enter deadlock!\n\n';
                output += `Processes that could finish: ${safeSeq.length > 0 ? 'P' + safeSeq.join(', P') : 'None'}`;
            }
            
            document.getElementById('bankers-output').innerHTML = output;
        }

        function loadRAGExample(type) {
            if (type === 'nocycle') {
                document.getElementById('rag-processes').value = 3;
                document.getElementById('rag-resources').value = 3;
                document.getElementById('rag-allocation').value = '0,1,0\n2,0,0\n3,0,2';
                document.getElementById('rag-request').value = '0,0,0\n0,0,2\n0,0,0';
            } else {
                document.getElementById('rag-processes').value = 3;
                document.getElementById('rag-resources').value = 3;
                document.getElementById('rag-allocation').value = '0,1,0\n2,0,0\n0,0,1';
                document.getElementById('rag-request').value = '2,0,0\n0,0,1\n0,1,0';
            }
        }

        function detectDeadlock() {
            const n = parseInt(document.getElementById('rag-processes').value);
            const m = parseInt(document.getElementById('rag-resources').value);
            
            const allocation = document.getElementById('rag-allocation').value.split('\n').map(row => row.split(',').map(Number));
            const request = document.getElementById('rag-request').value.split('\n').map(row => row.split(',').map(Number));
            
            const graph = Array(n + m).fill(0).map(() => Array(n + m).fill(0));
            
            for (let p = 0; p < n; p++) {
                for (let r = 0; r < m; r++) {
                    if (allocation[p][r] > 0) {
                        graph[n + r][p] = 1;
                    }
                    if (request[p][r] > 0) {
                        graph[p][n + r] = 1;
                    }
                }
            }
            
            let vizHTML = '<h3>Resource Allocation Graph</h3><div style="margin: 30px 0;">';
            
            for (let p = 0; p < n; p++) {
                vizHTML += `<div style="margin: 20px 0;">`;
                vizHTML += `<span class="node process-node">P${p}</span>`;
                
                for (let r = 0; r < m; r++) {
                    if (request[p][r] > 0) {
                        vizHTML += `<span class="arrow">‚Üí</span><span class="node resource-node">R${r}</span>`;
                    }
                    if (allocation[p][r] > 0) {
                        vizHTML += `<span class="arrow">‚Üê</span>`;
                    }
                }
                vizHTML += `</div>`;
            }
            vizHTML += '</div>';
            
            document.getElementById('rag-viz').innerHTML = vizHTML;
            
            let hasCycle = false;
            for (let i = 0; i < n + m; i++) {
                for (let j = 0; j < n + m; j++) {
                    if (graph[i][j] && graph[j][i]) {
                        hasCycle = true;
                        break;
                    }
                }
            }
            
            let output = 'üîç ANALYZING RESOURCE ALLOCATION GRAPH...\n\n';
            output += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n';
            
            output += 'ALLOCATION EDGES (Resource ‚Üí Process):\n';
            for (let p = 0; p < n; p++) {
                for (let r = 0; r < m; r++) {
                    if (allocation[p][r] > 0) {
                        output += `  R${r} ‚Üí P${p} (${allocation[p][r]} units)\n`;
                    }
                }
            }
            
            output += '\nREQUEST EDGES (Process ‚Üí Resource):\n';
            for (let p = 0; p < n; p++) {
                for (let r = 0; r < m; r++) {
                    if (request[p][r] > 0) {
                        output += `  P${p} ‚Üí R${r} (requesting ${request[p][r]} units)\n`;
                    }
                }
            }
            
            output += '\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n';
            
            if (hasCycle) {
                output += '<span class="unsafe-state">üî¥ DEADLOCK DETECTED!</span>\n\n';
                output += 'Circular wait condition exists in the system.\n';
                output += 'A cycle has been found in the RAG.\n\n';
                output += '‚ö†Ô∏è  System requires recovery action!';
            } else {
                output += '<span class="safe-state">‚úÖ NO DEADLOCK DETECTED</span>\n\n';
                output += 'No cycles found in Resource Allocation Graph.\n';
                output += 'System is operating normally.';
            }
            
            document.getElementById('rag-output').innerHTML = output;
        }

        function recoverDeadlock() {
            const n = parseInt(document.getElementById('rec-processes').value);
            const m = parseInt(document.getElementById('rec-resources').value);
            
            const allocation = document.getElementById('rec-allocation').value.split('\n').map(row => row.split(',').map(Number));
            const available = document.getElementById('rec-available').value.split(',').map(Number);
            
            let maxRes = -1, victim = -1;
            const resourceCounts = [];
            
            for (let p = 0; p < n; p++) {
                let sum = 0;
                for (let r = 0; r < m; r++) {
                    sum += allocation[p][r];
                }
                resourceCounts.push(sum);
                if (sum > maxRes) {
                    maxRes = sum;
                    victim = p;
                }
            }
            
            let output = 'üîß INITIATING DEADLOCK RECOVERY...\n\n';
            output += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n';
            
            output += 'VICTIM SELECTION ANALYSIS:\n';
            for (let p = 0; p < n; p++) {
                output += `  P${p}: Holding ${resourceCounts[p]} resource units [${allocation[p].join(', ')}]`;
                if (p === victim) {
                    output += ' ‚Üê SELECTED AS VICTIM';
                }
                output += '\n';
            }
            
            output += '\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n';
            output += '<span class="unsafe-state">‚ö° TERMINATING PROCESS P' + victim + '</span>\n\n';
            
            const newAvailable = [...available];
            for (let r = 0; r < m; r++) {
                newAvailable[r] += allocation[victim][r];
            }
            
            output += 'RESOURCE RECOVERY:\n';
            output += `  Before: [${available.join(', ')}]\n`;
            output += `  Released by P${victim}: [${allocation[victim].join(', ')}]\n`;
            output += `  After: [${newAvailable.join(', ')}]\n\n`;
            
            output += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n';
            output += '<span class="safe-state">‚úÖ RECOVERY SUCCESSFUL</span>\n\n';
            output += `Process P${victim} terminated and resources reclaimed.\n`;
            output += `Available resources increased from ${available.reduce((a,b)=>a+b,0)} to ${newAvailable.reduce((a,b)=>a+b,0)} units.\n`;
            output += 'System can now proceed with remaining processes.';
            
            document.getElementById('recovery-output').innerHTML = output;
        }
    </script>
</body>
</html>